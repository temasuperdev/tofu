# ะะตัะตะฝะธะต: ะะฐะทะฒะตัััะฒะฐะฝะธะต Flask ะฟัะธะปะพะถะตะฝะธั ัะตัะตะท GitHub Actions ะฒ K3s

## ๐ ะงัะพ ะฑัะปะพ ะธัะฟัะฐะฒะปะตะฝะพ

### 1. โ ะกะพะทะดะฐะฝ ะพัะดะตะปัะฝัะน deployment ะดะปั production
- **ะคะฐะนะป:** [k8s/deployment-production.yaml](k8s/deployment-production.yaml)
- ะัะฟะพะปัะทัะตั ะฟะตัะตะผะตะฝะฝัะต ะดะปั ะพะฑัะฐะทะฐ: `IMAGE_REGISTRY/IMAGE_NAME:IMAGE_TAG`
- ะกะพะดะตัะถะธั ะบะพะฝัะธะณััะฐัะธั ะดะปั Flask ะฟัะธะปะพะถะตะฝะธั (ะฟะพัั 5000, /api/health)
- ะะฐัััะพะตะฝะฐ ะฑะตะทะพะฟะฐัะฝะพััั ะธ health checks

### 2. โ ะะฑะฝะพะฒะปะตะฝ GitHub Actions workflow
- **ะคะฐะนะป:** [.github/workflows/ci-cd.yaml](.github/workflows/ci-cd.yaml)
- ะขะตะฟะตัั ะธัะฟะพะปัะทัะตั `deployment-production.yaml` ะฒะผะตััะพ `deployment.yaml`
- ะะพะฑะฐะฒะปะตะฝะฐ ะฟะพะดัะพะฑะฝะฐั ะพัะปะฐะดะพัะฝะฐั ะธะฝัะพัะผะฐัะธั ะฟัะธ ะพัะธะฑะบะฐั
- ะฃะปัััะตะฝั health checks ั ะฑะพะปััะธะผ ะบะพะปะธัะตััะฒะพะผ ะฟะพะฟััะพะบ (15 ะฒะผะตััะพ 10)
- ะะพะฑะฐะฒะปะตะฝั ะปะพะณะธ ะฟะพะดะพะฒ ะฟัะธ ะพัะธะฑะบะต ัะฐะทะฒะตัััะฒะฐะฝะธั

### 3. โ ะกะพะทะดะฐะฝะพ ััะบะพะฒะพะดััะฒะพ ะฟะพ ัะตัะตะฝะธั ะฟัะพะฑะปะตะผ
- **ะคะฐะนะป:** [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
- ะะธะฐะณะฝะพััะธัะตัะบะธะต ะบะพะผะฐะฝะดั
- ะขะธะฟะธัะฝัะต ะพัะธะฑะบะธ ะธ ะธั ัะตัะตะฝะธั
- ะงะตะบ-ะปะธัั ะฟะตัะตะด ะฟััะตะผ

## ๐ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### ะะพะบะฐะปัะฝะพ (ะดะปั ัะฐะทัะฐะฑะพัะบะธ)
```bash
# ะัะฟะพะปัะทัะตััั ะฟัะพััะพะน nginx ะฒ deployment-simple.yaml
kubectl apply -f k8s/deployment-simple.yaml
```

### ะงะตัะตะท GitHub Actions (production)
```bash
# GitHub Actions ะฐะฒัะพะผะฐัะธัะตัะบะธ:
# 1. ะกะพะฑะธัะฐะตั Dockerfile ะฒ ะพะฑัะฐะท
# 2. ะัะฟัะฐะฒะปัะตั ะฒ GHCR (GitHub Container Registry)
# 3. ะัะธะผะตะฝัะตั deployment-production.yaml ั ะฟะพะดััะฐะฒะปะตะฝะฝัะผ ะพะฑัะฐะทะพะผ
# 4. ะัะพะฒะตััะตั ััะพ ะฟัะธะปะพะถะตะฝะธะต ะทะฐะฟัััะธะปะพัั
```

## ๐ง Workflow GitHub Actions

```
โโโโโโโโโโโโโโโ
โ   Test      โ  โ pytest
โโโโโโโโฌโโโโโโโ
       โ
โโโโโโโโผโโโโโโโ
โ   Build     โ  โ docker build โ GHCR
โโโโโโโโฌโโโโโโโ
       โ
โโโโโโโโผโโโโโโโ
โ  Security   โ  โ Trivy scan
โโโโโโโโฌโโโโโโโ
       โ
โโโโโโโโผโโโโโโโ
โ   Deploy    โ  โ kubectl apply deployment-production.yaml
โโโโโโโโฌโโโโโโโ
       โ
โโโโโโโโผโโโโโโโ
โ  Verify     โ  โ Health checks
โโโโโโโโโโโโโโโ
```

## โ ะัะพะฒะตัะบะฐ ะฟะตัะตะด ะฟััะตะผ

### 1. ะะพะบะฐะปัะฝะพ ะฟัะพัะตััะธััะนัะต ัะฑะพัะบั
```bash
docker build -f docker/Dockerfile -t demo-app:test .
docker run -p 5000:5000 demo-app:test
# ะัะพะฒะตัััะต: curl http://localhost:5000/api/health
```

### 2. ะัะพัะตััะธััะนัะต ะปะพะบะฐะปัะฝัะน deployment
```bash
bash deploy-local-k3s.sh
# ะัะฟะพะปัะทัะตััั deployment-simple.yaml ั nginx
```

### 3. ะะพัะผะพััะธัะต ะปะพะณะธ
```bash
kubectl logs -f deployment/demo-app -n demo-app
```

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
k8s/
โโโ deployment.yaml              โ ะกัะฐััะน (ะฑัะป ะธัะฟะพะปัะทะพะฒะฐะฝ ะดะปั nginx)
โโโ deployment-simple.yaml       โ ะะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ (nginx)
โโโ deployment-production.yaml   โ โญ ะัะฟะพะปัะทัะตััั GitHub Actions
โโโ ingress.yaml
```

## ๐ ะัะปะธ ะฒัะต ะตัะต ะพัะธะฑะบะฐ CrashLoopBackOff

### ะจะฐะณ 1: ะัะพะฒะตัะธัั ะปะพะณะธ
```bash
kubectl logs -n demo-app --all-containers=true --tail=50
```

### ะจะฐะณ 2: ะัะพะฒะตัะธัั ะพะฑัะฐะท
```bash
# ะฃะฑะตะดะธัะตัั ััะพ ะพะฑัะฐะท ััะฟะตัะฝะพ ัะพะฑัะฐะฝ ะฒ GitHub Actions
# GitHub โ Actions โ ะัะฑะตัะธัะต ะฟะพัะปะตะดะฝะธะน ะทะฐะฟััะบ โ ะะฐะทะดะตะป "Build"

# ะัะพะฒะตัััะต ััะพ ะพะฑัะฐะท ะฒ GHCR
docker pull ghcr.io/<owner>/<repo>:<short-sha>
```

### ะจะฐะณ 3: ะัะพะฒะตัะธัั ะบะพะฝัะธะณััะฐัะธั
```bash
kubectl describe deployment demo-app -n demo-app
kubectl describe pod -n demo-app
```

### ะจะฐะณ 4: ะะพัะผะพััะตัั ัะพะฑััะธั
```bash
kubectl get events -n demo-app --sort-by='.lastTimestamp'
```

## ๐ฏ ะขะธะฟะธัะฝัะต ะฟัะพะฑะปะตะผั

| ะัะพะฑะปะตะผะฐ | ะะตัะตะฝะธะต |
|----------|---------|
| `ModuleNotFoundError: No module named 'src'` | setup.py + pip install -e . |
| ะะพะฝัะตะนะฝะตั ะฟะฐะดะฐะตั ััะฐะทั | ะัะพะฒะตัััะต ะปะพะณะธ: `kubectl logs` |
| Health check ะฟะฐะดะฐะตั | ะะฑัะฐะท ะผะพะถะตั ะฑััั ััะฐััะผ, ะพัะธััะธัะต ะธ ะฟะตัะตัะฐะทะฒะตัะฝะธัะต |
| ะะฑัะฐะท ะฝะต ะทะฐะณััะถะฐะตััั | ะัะพะฒะตัััะต ััะพ ะพะฝ ะฒ GHCR, ะผะพะถะตั ะฝัะถะฝะพ ะฟะตัะตัะพะฑัะฐัั |

## ๐ ะงะตะบ-ะปะธัั ะฟะตัะตะด ะฟััะตะผ

- [ ] ะขะตััั ะฟัะพัะพะดัั ะปะพะบะฐะปัะฝะพ: `pytest tests/`
- [ ] Dockerfile ัะพะฑะธัะฐะตััั: `docker build -f docker/Dockerfile .`
- [ ] ะะพะฝัะตะนะฝะตั ะทะฐะฟััะบะฐะตััั: `docker run -p 5000:5000 <image>`
- [ ] ะัะธะปะพะถะตะฝะธะต ะพัะฒะตัะฐะตั: `curl http://localhost:5000/api/health`
- [ ] setup.py ัััะตััะฒัะตั
- [ ] requirements.txt ะฐะบััะฐะปะตะฝ
- [ ] .github/workflows/ci-cd.yaml ะฑะตะท ัะธะฝัะฐะบัะธัะตัะบะธั ะพัะธะฑะพะบ

## ๐ ะขะตะฟะตัั ะผะพะถะตัะต ะฟััะธัั!

```bash
git add .
git commit -m "Fix: Use production deployment manifest for GitHub Actions"
git push origin main
```

GitHub Actions ะฐะฒัะพะผะฐัะธัะตัะบะธ:
1. ะะฐะฟัััะธั ัะตััั
2. ะกะพะฑะตัะตั Docker ะพะฑัะฐะท
3. ะัะฟัะฐะฒะธั ะฒ GHCR
4. ะะฐะทะฒะตัะฝะตั ะฒ K3s
5. ะัะพะฒะตัะธั ััะพ ะฟัะธะปะพะถะตะฝะธะต ัะฐะฑะพัะฐะตั

โ ะะพัะพะฒะพ!

#!/bin/bash
# Информационный скрипт - показывает что было создано для локального setup

echo -e "\033[0;32m"
cat << 'EOF'

╔════════════════════════════════════════════════════════════════════════════╗
║                                                                            ║
║      ✨ ЛОКАЛЬНАЯ РАЗРАБОТКА И РАЗВЕРТЫВАНИЕ - НАСТРОЙКА ЗАВЕРШЕНА! ✨   ║
║                                                                            ║
║                 Все запускается ПОЛНОСТЬЮ ЛОКАЛЬНО                       ║
║                 (без GitHub, без внешних сервисов)                       ║
║                                                                            ║
╚════════════════════════════════════════════════════════════════════════════╝

📋 ЧТО БЫЛО СОЗДАНО:
═════════════════════════════════════════════════════════════════════════════

🎯 ОСНОВНОЙ СКРИПТ (начните с этого):
   bash setup-local.sh              Полная локальная настройка (одна команда!)

🐳 УПРАВЛЕНИЕ DOCKER REGISTRY:
   bash registry.sh start           Запустить локальный registry
   bash registry.sh stop            Остановить registry
   bash registry.sh status          Статус registry
   bash registry.sh clean           Удалить registry

🏗️  СБОРКА И РАЗВЕРТЫВАНИЕ:
   bash build-local.sh              Собрать образ для локального registry
   bash deploy-local.sh             Развернуть в K3s
   bash cleanup-local.sh            Удалить всё

⚙️  АЛЬТЕРНАТИВА (make-like команды):
   bash make-local.sh help          Список всех команд
   bash make-local.sh setup         То же что setup-local.sh
   bash make-local.sh build         Собрать образ
   bash make-local.sh deploy        Развернуть
   bash make-local.sh port-forward  Port forward (8080:80)
   bash make-local.sh logs          Смотреть логи

📚 ДОКУМЕНТАЦИЯ:
   LOCAL_QUICKSTART.md              Быстрый старт за 2 минуты
   LOCAL_SETUP.md                   Полный гайд локальной разработки

⚙️  КОНФИГУРАЦИЯ:
   .env.local                       Локальные переменные
   .env.example                     Пример конфигурации

═════════════════════════════════════════════════════════════════════════════

🚀 QUICK START (одна команда):
═════════════════════════════════════════════════════════════════════════════

   bash setup-local.sh

Это сделает:
   1. ✅ Запустит локальный Docker Registry (http://localhost:5000)
   2. ✅ Соберет Docker образ
   3. ✅ Загрузит образ в локальный registry
   4. ✅ Развернет в K3s кластер
   5. ✅ Выведет инструкции для доступа

═════════════════════════════════════════════════════════════════════════════

📌 ПОСЛЕ SETUP (в другом терминале):
═════════════════════════════════════════════════════════════════════════════

   kubectl port-forward svc/demo-app 8080:80 -n demo-app

Затем откройте:
   http://localhost:8080

═════════════════════════════════════════════════════════════════════════════

🎯 ТИПИЧНЫЙ WORKFLOW:
═════════════════════════════════════════════════════════════════════════════

1️⃣  Первая настройка (один раз):
   bash setup-local.sh

2️⃣  Локальная разработка:
   python src/app.py                    (или docker-compose up)
   pytest tests/ -v

3️⃣  После изменений в коде - обновить в K3s:
   bash build-local.sh
   docker push localhost:5000/demo-app:latest
   kubectl rollout restart deployment/demo-app -n demo-app

4️⃣  Смотреть логи:
   kubectl logs -f deployment/demo-app -n demo-app

5️⃣  Очистка (если нужно):
   bash cleanup-local.sh

═════════════════════════════════════════════════════════════════════════════

🛠️  ПОЛЕЗНЫЕ КОМАНДЫ:
═════════════════════════════════════════════════════════════════════════════

Registry:
   bash registry.sh status               Статус
   curl http://localhost:5000/v2/_catalog | jq .    Список образов

K3s:
   kubectl get all -n demo-app          Все ресурсы
   kubectl describe pod <pod-name> -n demo-app
   kubectl exec -it <pod-name> -n demo-app -- /bin/bash

Тесты:
   pytest tests/ -v                     Запустить тесты
   curl http://localhost:8080/api/health | jq .

═════════════════════════════════════════════════════════════════════════════

📁 СТРУКТУРА ФАЙЛОВ:
═════════════════════════════════════════════════════════════════════════════

Локальная разработка:
   setup-local.sh          → Главный скрипт (запустить)
   registry.sh             → Управление Docker Registry
   build-local.sh          → Сборка образа
   deploy-local.sh         → Развертывание в K3s
   cleanup-local.sh        → Очистка ресурсов
   make-local.sh           → Альтернатива bash (как make)
   
Конфигурация:
   .env.local              → Ваши переменные
   .env.example            → Пример конфигурации
   
Документация:
   LOCAL_QUICKSTART.md     → Быстрый старт (2 мин)
   LOCAL_SETUP.md          → Полный гайд (20 мин)
   DOCUMENTATION_MAP.md    → Карта документации

═════════════════════════════════════════════════════════════════════════════

✨ ПРЕИМУЩЕСТВА ЛОКАЛЬНОГО SETUP:
═════════════════════════════════════════════════════════════════════════════

✅ Полностью автономная среда (без интернета)
✅ Быстрая разработка и тестирование
✅ Не нужна учетная запись GitHub/Docker Hub
✅ Полный контроль над Docker Registry
✅ Местные образы хранятся на вашей машине
✅ Подходит для обучения и разработки
✅ Легко удалить всё и начать заново

═════════════════════════════════════════════════════════════════════════════

🎓 ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ:
═════════════════════════════════════════════════════════════════════════════

Пример 1: Полная локальная разработка
   bash setup-local.sh                              (полная настройка)
   # Отредактируйте src/app.py
   bash build-local.sh                              (пересобрать)
   docker push localhost:5000/demo-app:latest       (загрузить)
   kubectl rollout restart deployment/demo-app -n demo-app
   # Открыть http://localhost:8080

Пример 2: Быстрая локальная разработка (без K3s)
   python src/app.py                                (разрабатываем)
   pytest tests/ -v                                 (тестируем)
   # Когда готово:
   bash setup-local.sh                              (развернуть в K3s)

Пример 3: Использование Docker Compose
   docker-compose up                                (локальная разработка)
   # Тестировать на http://localhost:5000
   # Когда готово:
   bash setup-local.sh                              (развернуть в K3s)

═════════════════════════════════════════════════════════════════════════════

🆘 НУЖНА ПОМОЩЬ?
═════════════════════════════════════════════════════════════════════════════

Быстрый старт:
   → LOCAL_QUICKSTART.md              (2-минутный гайд)

Полный гайд:
   → LOCAL_SETUP.md                   (20-минутный гайд с примерами)

Общая документация:
   → DOCUMENTATION_MAP.md             (карта всей документации)

Troubleshooting:
   → K3S_DEPLOYMENT.md (раздел "Troubleshooting")
   → README_MAIN.md (раздел "Troubleshooting")

═════════════════════════════════════════════════════════════════════════════

✅ ВСЕ ГОТОВО К РАБОТЕ!
═════════════════════════════════════════════════════════════════════════════

Начните с одной команды:
   
   bash setup-local.sh

═════════════════════════════════════════════════════════════════════════════

Счастливой разработки! 🚀

EOF
echo -e "\033[0m"

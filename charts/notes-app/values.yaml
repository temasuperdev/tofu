# Общие настройки
global:
 domain: "serv.temasuug.ru"
 namespace: "note"
 repositoryOwner: "your-username"

# Настройки фронтенда
frontend:
 replicaCount: 2
 repositoryOwner: "temasuug"
 image:
   repository: "ghcr.io/{{ .Values.global.repositoryOwner }}/notes-frontend"
   pullPolicy: IfNotPresent
   tag: "latest"
 service:
   type: ClusterIP
   port: 80
 ingress:
   enabled: true
   className: "traefik"
   annotations:
     cert-manager.io/cluster-issuer: letsencrypt-prod
     traefik.ingress.kubernetes.io/router.entrypoints: websecure
     traefik.ingress.kubernetes.io/router.tls: "true"
     # Security headers
     traefik.ingress.kubernetes.io/router.priority: "100"
   hosts:
     - host: "serv.temasuug.ru"
       paths:
         - path: /
           pathType: Prefix
   tls:
     - secretName: notes-tls-cert
       hosts:
         - serv.temasuug.ru

# Настройки бэкенда
backend:
 replicaCount: 2
 image:
   repository: "ghcr.io/{{ .Values.global.repositoryOwner }}/notes-backend"
   pullPolicy: Always
   tag: "latest"
 service:
   type: ClusterIP
   port: 8000
 env:
   DATABASE_URL: "postgresql://postgres:strong-password@notes-postgresql:5432/notesdb"
   SECRET_KEY: "your-secret-key-here"
   ALGORITHM: "HS256"
   ACCESS_TOKEN_EXPIRE_MINUTES: 30
   SERVER_HOST: "0.0.0.0"
   SERVER_PORT: "8000"
   BACKEND_CORS_ORIGINS: "https://serv.temasuug.ru"

# Настройки PostgreSQL
postgresql:
 enabled: true
 image:
   registry: docker.io
   repository: bitnami/postgresql
   tag: "latest"
 auth:
   postgresPassword: "strong-password"
   database: "notesdb"
 primary:
   persistence:
     enabled: true
     size: 10Gi
     storageClass: "local-path"
   # Добавляем параметры, которые помогут избежать конфликта при обновлении
   configuration: |
     max_connections = 300
     shared_buffers = 128MB
   extendedConfiguration: |
     log_min_messages = WARNING
   initdb:
     scriptsConfigMap: null
   updateStrategy:
     type: RollingUpdate
   # Указываем политику хранения PVC, чтобы избежать конфликта при обновлении
   persistentVolumeClaimRetentionPolicy:
     whenDeleted: Retain
     whenScaled: Retain
 architecture: standalone

# Настройки мониторинга
monitoring:
  enabled: true
  prometheus:
    enabled: true
  grafana:
    enabled: true

# Настройки логирования
logging:
  enabled: true
  elasticsearch:
    enabled: true
  fluentd:
    enabled: true

# Зависимости

traefik:
  middlewareEnabled: true
  tlsStoreEnabled: true
  tlsOptions:
    name: default
    cipherSuites:
      - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
      - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
      - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
      - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
      - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
      - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
    minVersion: VersionTLS12
    maxVersion: VersionTLS13
    sniStrict: true

cert-manager:
  enabled: true
  installCRDs: false
  clusterIssuer:
    name: letsencrypt-prod
    email: "admin@temasuug.ru" # Укажите ваш email для Let's Encrypt
    server: "https://acme-v02.api.letsencrypt.org/directory"